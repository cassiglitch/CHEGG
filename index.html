<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>CHEGG Card Game Variant</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #f4f4f4;
        margin: 0;
        padding: 10px;
      }
      h1 {
        text-align: center;
      }
      #gameContainer {
        max-width: 900px;
        margin: 0 auto;
        background: #fff;
        padding: 10px;
        box-shadow: 0 0 10px rgba(0,0,0,0.2);
      }
      .section {
        margin-bottom: 15px;
      }
      #opponentArea, #playerArea {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 5px;
        border: 1px solid #ccc;
        background: #e9e9e9;
      }
      .battlefield {
        min-height: 80px;
        padding: 5px;
        border: 1px dashed #888;
        background: #fff;
        margin: 5px 0;
      }
      .card, .minion {
        display: inline-block;
        border: 1px solid #333;
        border-radius: 4px;
        background: #fafafa;
        padding: 5px;
        margin: 5px;
        cursor: pointer;
      }
      .selected {
        border: 2px solid #f80;
        background: #fffae6;
      }
      #handContainer {
        padding: 5px;
        border: 1px solid #888;
        background: #fff;
        min-height: 100px;
      }
      #message {
        margin-top: 10px;
        padding: 5px;
        background: #eef;
        border: 1px solid #99f;
      }
      #controls {
        text-align: center;
        margin-top: 10px;
      }
      button {
        margin: 5px;
        padding: 8px 16px;
        font-size: 16px;
      }
      .info {
        font-size: 18px;
      }
    </style>
  </head>
  <body>
    <div id="gameContainer">
      <h1>CHEGG Card Game Variant</h1>
      <!-- Opponent Info -->
      <div id="opponentArea" class="section">
        <div>
          <strong>Opponent Villager</strong><br>
          <span id="opponentHeroHP" class="info"></span>
        </div>
        <div>
          <strong>Opponent Battlefield</strong>
          <div id="opponentBattlefield" class="battlefield"></div>
        </div>
        <div>
          <strong>Opponent Mana</strong><br>
          <span id="opponentMana" class="info"></span>
        </div>
      </div>
      
      <!-- Player Info -->
      <div id="playerArea" class="section">
        <div>
          <strong>Your Villager</strong><br>
          <span id="playerHeroHP" class="info"></span>
        </div>
        <div>
          <strong>Your Battlefield</strong>
          <div id="playerBattlefield" class="battlefield"></div>
        </div>
        <div>
          <strong>Your Mana</strong><br>
          <span id="playerMana" class="info"></span>
        </div>
      </div>
      
      <!-- Player Hand -->
      <div class="section">
        <strong>Your Hand</strong>
        <div id="handContainer"></div>
      </div>
      
      <!-- Controls -->
      <div id="controls" class="section">
        <button onclick="endTurn()" id="endTurnButton">End Turn</button>
        <button onclick="initGame()">Restart Game</button>
      </div>
      
      <!-- Message Log -->
      <div id="message" class="section">Welcome to CHEGG Card Game!</div>
    </div>
    
    <script>
      /***** GAME CONFIGURATION *****/
      const MAX_MANA = 6;
      const STARTING_HP = 20;
      
      // Define card templates
      const cardTemplates = {
        "Villager": { type: "hero", name: "Villager", cost: 0, attack: 0, hp: STARTING_HP },
        "Zombie":   { type: "minion", name: "Zombie", cost: 1, attack: 1, hp: 1 },
        "Skeleton": { type: "minion", name: "Skeleton", cost: 3, attack: 3, hp: 2 },
        "Reinforcement": { type: "spell", name: "Reinforcement", cost: 2, effect: "draw2" }
      };
      
      /***** GAME STATE *****/
      let currentTurn = "player"; // or "ai"
      let turnNumber = 1;
      
      let player = {
        hero: null,
        deck: [],
        hand: [],
        battlefield: [],
        currentMana: 0,
        maxMana: 0
      };
      
      let ai = {
        hero: null,
        deck: [],
        hand: [],
        battlefield: [],
        currentMana: 0,
        maxMana: 0
      };
      
      // For selecting an attacker during player's combat phase
      let selectedAttacker = null;
      
      /***** INITIALIZATION *****/
      function initGame() {
        // Reset turn and state
        turnNumber = 1;
        currentTurn = "player";
        selectedAttacker = null;
        
        // Create hero for both sides
        player.hero = Object.assign({}, cardTemplates["Villager"]);
        ai.hero = Object.assign({}, cardTemplates["Villager"]);
        
        // Build decks (for simplicity, each deck will have 10 Zombies, 5 Skeletons, 3 Reinforcement)
        player.deck = buildDeck();
        ai.deck = buildDeck();
        
        // Shuffle decks
        player.deck.sort(() => Math.random() - 0.5);
        ai.deck.sort(() => Math.random() - 0.5);
        
        // Clear hands and battlefields
        player.hand = [];
        ai.hand = [];
        player.battlefield = [];
        ai.battlefield = [];
        
        // Draw initial hand (5 cards)
        for (let i = 0; i < 5; i++) {
          drawCard("player");
          drawCard("ai");
        }
        
        // Initialize mana
        player.maxMana = 0;
        player.currentMana = 0;
        ai.maxMana = 0;
        ai.currentMana = 0;
        
        updateUI();
        logMessage("Game started! Your turn begins.");
        startTurn("player");
      }
      
      function buildDeck() {
        let deck = [];
        for (let i = 0; i < 10; i++) {
          deck.push("Zombie");
        }
        for (let i = 0; i < 5; i++) {
          deck.push("Skeleton");
        }
        for (let i = 0; i < 3; i++) {
          deck.push("Reinforcement");
        }
        return deck;
      }
      
      function drawCard(side) {
        let p = (side === "player") ? player : ai;
        if (p.deck.length > 0) {
          let cardKey = p.deck.shift();
          p.hand.push(cardKey);
        } else {
          logMessage(side + " has no cards left in the deck!");
        }
      }
      
      /***** TURN MANAGEMENT *****/
      function startTurn(side) {
        currentTurn = side;
        if (side === "player") {
          turnNumber++;
          // Increase mana (up to MAX_MANA)
          player.maxMana = Math.min(player.maxMana + 1, MAX_MANA);
          player.currentMana = player.maxMana;
          drawCard("player");
          logMessage("Your turn. You have " + player.currentMana + " mana.");
          updateUI();
        } else {
          // AI turn
          ai.maxMana = Math.min(ai.maxMana + 1, MAX_MANA);
          ai.currentMana = ai.maxMana;
          drawCard("ai");
          logMessage("AI turn. AI has " + ai.currentMana + " mana.");
          updateUI();
          setTimeout(aiTurn, 1000);
        }
      }
      
      function endTurn() {
        if (currentTurn !== "player") return;
        logMessage("Ending your turn.");
        // Reset minions’ attack status for next turn after combat phase ends.
        player.battlefield.forEach(m => m.attacked = false);
        currentTurn = "ai";
        updateUI();
        setTimeout(aiTurn, 1000);
      }
      
      /***** PLAYER ACTIONS *****/
      
      // Clicking on a card in hand to play it
      function playCard(index) {
        if (currentTurn !== "player") return;
        let cardKey = player.hand[index];
        let cardTemplate = cardTemplates[cardKey];
        if (player.currentMana < cardTemplate.cost) {
          logMessage("Not enough mana to play " + cardTemplate.name + ".");
          return;
        }
        // Spend mana and remove card from hand
        player.currentMana -= cardTemplate.cost;
        player.hand.splice(index, 1);
        if (cardTemplate.type === "minion") {
          // Summon the minion onto the battlefield with its current HP and attack, and mark it as not having attacked yet.
          let minion = Object.assign({}, cardTemplate);
          minion.currentHP = cardTemplate.hp;
          minion.attacked = false;
          player.battlefield.push(minion);
          logMessage("You summoned a " + minion.name + ".");
        } else if (cardTemplate.type === "spell") {
          // Spell effect – here we only implement "Reinforcement": draw 2 cards.
          if (cardTemplate.effect === "draw2") {
            drawCard("player");
            drawCard("player");
            logMessage("You cast Reinforcement and drew 2 cards.");
          }
        }
        updateUI();
      }
      
      // Clicking on a minion on player's battlefield to select it for attack.
      function selectAttacker(index) {
        if (currentTurn !== "player") return;
        let attacker = player.battlefield[index];
        if (attacker.attacked) {
          logMessage("This minion has already attacked.");
          return;
        }
        selectedAttacker = { minion: attacker, index: index };
        logMessage("Selected " + attacker.name + " as attacker. Click on the opponent's hero or one of their minions to attack.");
        updateUI();
      }
      
      // When player clicks on opponent hero to attack
      function attackHero() {
        if (!selectedAttacker) return;
        let attacker = selectedAttacker.minion;
        ai.hero.hp -= attacker.attack;
        attacker.attacked = true;
        logMessage("Your " + attacker.name + " attacked the opponent's Villager for " + attacker.attack + " damage.");
        selectedAttacker = null;
        checkVictory();
        updateUI();
      }
      
      // When player clicks on an opponent minion to attack
      function attackMinion(aiIndex) {
        if (!selectedAttacker) return;
        let attacker = selectedAttacker.minion;
        let defender = ai.battlefield[aiIndex];
        // Both deal damage simultaneously
        defender.currentHP -= attacker.attack;
        attacker.currentHP -= defender.attack;
        logMessage("Your " + attacker.name + " attacked opponent's " + defender.name + ".");
        attacker.attacked = true;
        // Remove defender if its HP is 0 or less
        if (defender.currentHP <= 0) {
          logMessage("Opponent's " + defender.name + " was destroyed.");
          ai.battlefield.splice(aiIndex, 1);
        }
        // Remove attacker if its HP is 0 or less
        if (attacker.currentHP <= 0) {
          logMessage("Your " + attacker.name + " was destroyed in combat.");
          player.battlefield.splice(selectedAttacker.index, 1);
        }
        selectedAttacker = null;
        checkVictory();
        updateUI();
      }
      
      /***** AI TURN LOGIC *****/
      function aiTurn() {
        // AI plays a card from hand if possible
        for (let i = 0; i < ai.hand.length; i++) {
          let cardKey = ai.hand[i];
          let cardTemplate = cardTemplates[cardKey];
          if (ai.currentMana >= cardTemplate.cost && cardTemplate.type === "minion") {
            ai.currentMana -= cardTemplate.cost;
            ai.hand.splice(i, 1);
            let minion = Object.assign({}, cardTemplate);
            minion.currentHP = cardTemplate.hp;
            minion.attacked = false;
            ai.battlefield.push(minion);
            logMessage("AI summoned a " + minion.name + ".");
            break;
          } else if (ai.currentMana >= cardTemplate.cost && cardTemplate.type === "spell") {
            // For the Reinforcement spell, simply draw 2 cards.
            if (cardTemplate.effect === "draw2") {
              ai.currentMana -= cardTemplate.cost;
              ai.hand.splice(i, 1);
              drawCard("ai");
              drawCard("ai");
              logMessage("AI cast Reinforcement.");
              break;
            }
          }
        }
        // AI combat: each AI minion attacks if able.
        ai.battlefield.forEach(minion => {
          if (!minion.attacked) {
            // If opponent has minions, attack the first one; otherwise, attack the hero.
            if (player.battlefield.length > 0) {
              let defender = player.battlefield[0];
              defender.currentHP -= minion.attack;
              minion.currentHP -= defender.attack;
              logMessage("AI's " + minion.name + " attacked your " + defender.name + ".");
              if (defender.currentHP <= 0) {
                logMessage("Your " + defender.name + " was destroyed.");
                player.battlefield.shift();
              }
              if (minion.currentHP <= 0) {
                logMessage("AI's " + minion.name + " was destroyed in combat.");
              }
            } else {
              player.hero.hp -= minion.attack;
              logMessage("AI's " + minion.name + " attacked your Villager for " + minion.attack + " damage.");
            }
            minion.attacked = true;
          }
        });
        checkVictory();
        // End of AI turn: reset minion attack flags for both sides.
        player.battlefield.forEach(m => m.attacked = false);
        ai.battlefield.forEach(m => m.attacked = false);
        currentTurn = "player";
        // Increase player's mana for next turn if applicable.
        player.maxMana = Math.min(player.maxMana + 1, MAX_MANA);
        player.currentMana = player.maxMana;
        drawCard("player");
        logMessage("Your turn begins.");
        updateUI();
      }
      
      /***** VICTORY CHECK *****/
      function checkVictory() {
        if (player.hero.hp <= 0) {
          logMessage("Your Villager has been defeated. You lose!");
          currentTurn = "gameover";
        }
        if (ai.hero.hp <= 0) {
          logMessage("Opponent's Villager has been defeated. You win!");
          currentTurn = "gameover";
        }
      }
      
      /***** UI UPDATES *****/
      function updateUI() {
        // Update hero health and mana
        document.getElementById("playerHeroHP").innerText = player.hero.hp;
        document.getElementById("opponentHeroHP").innerText = ai.hero.hp;
        document.getElementById("playerMana").innerText = player.currentMana + " / " + player.maxMana;
        document.getElementById("opponentMana").innerText = ai.currentMana + " / " + ai.maxMana;
        
        // Update battlefield display
        let playerBF = document.getElementById("playerBattlefield");
        playerBF.innerHTML = "";
        player.battlefield.forEach((minion, index) => {
          let div = document.createElement("div");
          div.className = "minion" + (selectedAttacker && selectedAttacker.index === index ? " selected" : "");
          div.innerText = minion.name + "\n" + minion.attack + "/" + minion.currentHP;
          // Clicking on a minion selects it for attack
          div.onclick = () => selectAttacker(index);
          playerBF.appendChild(div);
        });
        let opponentBF = document.getElementById("opponentBattlefield");
        opponentBF.innerHTML = "";
        ai.battlefield.forEach((minion, index) => {
          let div = document.createElement("div");
          div.className = "minion";
          div.innerText = minion.name + "\n" + minion.attack + "/" + minion.currentHP;
          // Clicking on an opponent minion attacks it (if an attacker is selected)
          div.onclick = () => {
            if (selectedAttacker) attackMinion(index);
          };
          opponentBF.appendChild(div);
        });
        
        // Update hand display (player only)
        let handContainer = document.getElementById("handContainer");
        handContainer.innerHTML = "";
        player.hand.forEach((cardKey, index) => {
          let card = cardTemplates[cardKey];
          let div = document.createElement("div");
          div.className = "card";
          div.innerText = card.name + "\nCost: " + card.cost;
          // Clicking on a card plays it
          div.onclick = () => playCard(index);
          handContainer.appendChild(div);
        });
        
        // For opponent's hand we do not show cards.
      }
      
      function logMessage(msg) {
        let messageDiv = document.getElementById("message");
        messageDiv.innerText = msg;
      }
      
      // Allow clicking on opponent hero to attack directly
      document.getElementById("opponentArea").onclick = function(e) {
        // Only if click is on the hero section (not on battlefield)
        if (e.target.id === "opponentHeroHP" || e.target.parentNode.id === "opponentArea") {
          if (selectedAttacker) {
            attackHero();
          }
        }
      }
      
      // Start the game when the page loads.
      window.onload = initGame;
    </script>
  </body>
</html>
